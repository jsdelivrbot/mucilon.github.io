<!DOCTYPE html>
<html lang=en>
	<head>
		<meta charset=utf-8>
		<title>My first Three.js app in Altspace</title>
		<script src="https://cdn.rawgit.com/mrdoob/three.js/r84/build/three.min.js"></script>
		<script src="https://cdn.rawgit.com/mrdoob/three.js/r84/examples/js/loaders/MTLLoader.js"></script>
		<script src="https://cdn.rawgit.com/mrdoob/three.js/r84/examples/js/loaders/OBJLoader.js"></script>
		<script src="dist/altspace.js"></script>
	</head>
	<body>
		<script>
		if (!window.altspace || !window.altspace.inClient) {
			document.write('<h3>To view this example, please open this page in <a href="http://altvr.com"> AltspaceVR </a></h3>');
		}


		var scene = new THREE.Scene();
		var renderer = altspace.getThreeJSRenderer({version:'0.2.0'});

	
		var scalaorbita= 500;
        var scalasol = 20000;
        var scalaterra = scalasol*30;
        var sunradius = 0.004*scalasol;
        var earthradius = 0.0000425*scalaterra;
        var afelioearth = 1.010*scalaorbita;
        var perielioearth = 0.976*scalaorbita;

        var raiomaior2 = ((afelioearth + perielioearth)/2);
        var centro2 = raiomaior2 - perielioearth;
        var raiomenor2 = Math.sqrt(Math.pow(raiomaior2,2) - Math.pow(centro2,2) );



		function Ellipse(xRadius, yRadius) {

		THREE.Curve.call( this );

		// add radius as a property
		this.xRadius = xRadius;
		this.yRadius = yRadius;
		}

		Ellipse.prototype = Object.create( THREE.Curve.prototype );
		Ellipse.prototype.constructor = Ellipse;

		// define the getPoint function for the subClass
		Ellipse.prototype.getPoint = function ( t ) {

			var radians = 2 * Math.PI * t;

			return new THREE.Vector3( this.xRadius * Math.cos( radians ),
									  0,
									  this.yRadius * Math.sin( radians ) );

		};

	 	function createOrbitPath(afelio,perielio){

        	var raiomaior = ((afelio + perielio)/2);
        	var centro = raiomaior - perielio;
            var raiomenor = Math.sqrt(Math.pow(raiomaior,2) - Math.pow(centro,2) );
            var path = new Ellipse(raiomaior,raiomenor);
			return path

        };


		function createOrbitEllipse(path,afelio,perielio){

			var pathSegments = 64;
			var tubeRadius = 0.5;
			var radiusSegments = 16;
			var closed = true;

			var geometry = new THREE.TubeGeometry( path, pathSegments, tubeRadius, radiusSegments, closed );
			    			
			var material = new THREE.MeshPhongMaterial( {color: 0xffffff, } );
			    		    // mesh
			var mesh = new THREE.Mesh( geometry, material );

			var raiomaior = ((afelio + perielio)/2);
        	var centro = raiomaior - perielio;

			mesh.position.x = centro;

			return mesh
		};



		function CreateSun(radius){
			var geometry	= new THREE.SphereGeometry(radius, 32, 32)
			var texture	= THREE.ImageUtils.loadTexture('images/sunmap.jpg')
			var material	= new THREE.MeshPhongMaterial({
				map	: texture,
				bumpMap	: texture,
				bumpScale: 0.05,
			})
			var mesh	= new THREE.Mesh(geometry, material);
			return mesh	
		};


		function CreateEarth(radius){
			var geometry	= new THREE.SphereGeometry(radius, 32, 32)
			var material	= new THREE.MeshPhongMaterial({
				map		: THREE.ImageUtils.loadTexture('images/earthmap1k.jpg'),
				bumpMap		: THREE.ImageUtils.loadTexture('images/earthbump1k.jpg'),
				bumpScale	: 0.05,
				specularMap	: THREE.ImageUtils.loadTexture('images/earthspec1k.jpg'),
				specular	: new THREE.Color('grey'),
			})
			var mesh	= new THREE.Mesh(geometry, material);
			return mesh	
		};


		//configurando as vari√°veis da esfera
	

		var sun = CreateSun(sunradius);
		scene.add(sun);

		var earth = CreateEarth(earthradius);
		scene.add(earth);

        var terrapath = createOrbitPath(afelioearth,perielioearth);

		var terraorbita = createOrbitEllipse(terrapath,afelioearth,perielioearth);
	    scene.add(terraorbita);


		//Update & Rendering
	
		function render() {
			requestAnimationFrame(render);

 			sun.position.x = 0;
 			sun.position.y = -300;
 			sun.position.z = 0;

            terraorbita.position.y = sun.position.y;
            terraorbita.position.z = sun.position.z;


		    var radians = 2 * Math.PI * 0.01;

	//	earth.position.set( raiomaior2 * Math.cos( radians ),sun.position.y,raiomenor2 * Math.sin( radians ) );

			renderer.render(scene);
		}
		render(); 
		</script>
	</body>
</html>
